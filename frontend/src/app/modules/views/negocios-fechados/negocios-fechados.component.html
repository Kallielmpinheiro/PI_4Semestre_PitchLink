<div class="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 p-4 lg:p-6">
  <div class="max-w-7xl mx-auto">
    <!-- Header Melhorado -->
    <div class="mb-8">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
        <div>
          <div class="flex items-center space-x-3 mb-2">
            <div
              class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
              <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z">
                </path>
              </svg>
            </div>
            <h1 class="text-3xl lg:text-4xl font-bold text-white">Negócios Fechados</h1>
          </div>
          <p class="text-gray-400 text-base lg:text-lg">Visualize e gerencie seus investimentos concluídos</p>
        </div>

        <div class="flex flex-col sm:flex-row items-start sm:items-center gap-3">
          <!-- Estatísticas Rápidas -->
          <div class="flex gap-3">
            <div
              class="bg-green-500/20 border border-green-500/30 rounded-xl px-4 py-3 backdrop-blur-sm hover:bg-green-500/25 transition-colors duration-200">
              <div class="flex items-center space-x-2">
                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                <span class="text-green-400 text-sm font-semibold">{{ proposals.length }} Ativos</span>
              </div>
            </div>
            <div
              class="bg-blue-500/20 border border-blue-500/30 rounded-xl px-4 py-3 backdrop-blur-sm hover:bg-blue-500/25 transition-colors duration-200">
              <div class="flex items-center space-x-2">
                <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1">
                  </path>
                </svg>
                <span class="text-blue-400 text-sm font-semibold">{{ filteredProposals.length }} Filtrados</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State Melhorado -->
    <div *ngIf="loading" class="flex flex-col justify-center items-center py-20">
      <div class="relative">
        <div class="animate-spin rounded-full h-16 w-16 border-4 border-gray-700"></div>
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-blue-500 absolute top-0 left-0"></div>
      </div>
      <p class="text-gray-400 mt-4 text-lg">Carregando negócios...</p>
    </div>

    <!-- Error State Melhorado -->
    <div *ngIf="error && !loading"
      class="bg-gradient-to-r from-red-500/20 to-pink-500/20 border border-red-500/30 rounded-2xl p-6 mb-6 backdrop-blur-sm">
      <div class="flex items-center space-x-3">
        <svg class="w-8 h-8 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <div>
          <h3 class="text-red-400 font-semibold text-lg">Erro ao carregar</h3>
          <p class="text-red-300">{{ error }}</p>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div *ngIf="!loading && !error">
      <!-- Filtros Melhorados -->
      <div class="mb-8">
        <div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 rounded-2xl p-6">
          <div class="flex flex-col lg:flex-row gap-4">
            <div class="flex-1">
              <label class="block text-sm font-medium text-gray-300 mb-2">Filtrar por Status</label>
              <select (change)="onStatusFilterChange($event)"
                class="w-full bg-gray-900/50 border border-gray-600/50 text-white rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 appearance-none">
                <option value="all">Todos os Status</option>
                <option value="pending">Pendente</option>
                <option value="cancelled">Cancelada</option>
                <option value="rejected">Rejeitada</option>
                <option value="accepted_request">Aceita - Solicitação</option>
                <option value="accepted_proposal">Aceita - Proposta</option>
                <option value="accepted_contract">Aceita - Contrato</option>
                <option value="completed">Finalizada</option>
              </select>
            </div>
            <div class="flex-1">
              <label class="block text-sm font-medium text-gray-300 mb-2">Ordenar por</label>
              <select (change)="onSortChange($event)"
                class="w-full bg-gray-900/50 border border-gray-600/50 text-white rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 appearance-none">
                <option value="date">Data de Criação</option>
                <option value="value">Valor Investido</option>
                <option value="roi">Porcentagem</option>
                <option value="paid">Status Pagamento</option>
              </select>
            </div>
            <div class="flex items-end">
              <button (click)="statusFilter = 'all'; sortBy = 'date'; applyFilters()"
                class="inline-flex items-center gap-x-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium px-6 py-3 rounded-xl transition-all duration-200 shadow-lg hover:shadow-blue-500/25">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.707A1 1 0 013 7V4z">
                  </path>
                </svg>
                <span>Limpar Filtros</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Lista de Negócios Completamente Corrigida -->
      <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8">
        <div *ngFor="let proposal of filteredProposals"
          class="group bg-gradient-to-br from-gray-800/60 via-gray-800/40 to-gray-900/60 backdrop-blur-sm border border-gray-700/40 rounded-3xl p-6 hover:border-gray-600/60 hover:shadow-2xl hover:shadow-blue-500/10 transition-all duration-500 cursor-pointer relative overflow-hidden transform hover:-translate-y-2"
          (click)="openModal(proposal)">

          <!-- Background Decorativo Animado -->
          <div class="absolute inset-0 opacity-5">
            <div
              class="absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-blue-500 via-purple-500 to-pink-500 rounded-full -translate-y-12 translate-x-12 blur-2xl group-hover:scale-125 transition-transform duration-700">
            </div>
            <div
              class="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-tr from-emerald-500 via-teal-500 to-cyan-500 rounded-full translate-y-8 -translate-x-8 blur-2xl group-hover:scale-110 transition-transform duration-700">
            </div>
          </div>

          <!-- Shine Effect -->
          <div
            class="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-1000 ease-out">
          </div>

          <!-- Header do Card -->
          <div class="relative flex items-start justify-between mb-6">
            <div class="flex items-center space-x-3">
              <!-- Status Indicator Minimalista -->
              <div class="w-3 h-3 rounded-full" [ngClass]="{
                   'bg-green-500': proposal.status === 'accepted_request' || proposal.status === 'accepted_proposal' || proposal.status === 'accepted_contract' || proposal.status === 'completed',
                   'bg-yellow-500': proposal.status === 'pending',
                   'bg-red-500': proposal.status === 'rejected' || proposal.status === 'cancelled'
                 }">
              </div>

              <!-- Status Badge com Texto Preto -->
              <span
                class="inline-flex items-center font-medium text-sm px-3 py-1 rounded-lg border text-black transition-colors duration-200"
                [ngClass]="{
                      'bg-green-100 border-green-300': proposal.status === 'accepted_request' || proposal.status === 'accepted_proposal' || proposal.status === 'accepted_contract' || proposal.status === 'completed',
                      'bg-yellow-100 border-yellow-300': proposal.status === 'pending',
                      'bg-red-100 border-red-300': proposal.status === 'rejected' || proposal.status === 'cancelled'
                    }">
                {{ getStatusText(proposal.status) }}
              </span>
            </div>

            <!-- Card Actions -->
            <div class="flex items-center space-x-3">
              <!-- ID Badge -->
              <div class="px-3 py-1 bg-gray-700/50 border border-gray-600/30 rounded-lg backdrop-blur-sm">
                <span class="text-xs text-gray-300 font-mono">#{{ proposal.id }}</span>
              </div>

              <!-- Payment Status Badge -->
              <div class="relative">
                <span class="inline-flex items-center text-xs font-medium px-3 py-1 rounded-lg border backdrop-blur-sm"
                  [ngClass]="{
                    'text-emerald-300 bg-emerald-500/20 border-emerald-500/40': proposal.paid,
                    'text-orange-300 bg-orange-500/20 border-orange-500/40': !proposal.paid
                  }">
                  <div class="w-2 h-2 rounded-full mr-2" [ngClass]="{
                          'bg-emerald-400': proposal.paid,
                          'bg-orange-400': !proposal.paid
                        }">
                  </div>
                  {{ getPaymentStatus(proposal) }}
                </span>
              </div>
            </div>
          </div>

          <!-- Título e Descrição -->
          <div class="relative mb-6">
            <h3
              class="text-2xl lg:text-3xl font-bold text-white mb-4 leading-tight group-hover:text-transparent group-hover:bg-gradient-to-r group-hover:from-blue-400 group-hover:via-purple-400 group-hover:to-pink-400 group-hover:bg-clip-text transition-all duration-500">
              {{ proposal.innovation_name }}
            </h3>
            <div class="relative">
              <p
                class="text-gray-400 text-sm leading-relaxed line-clamp-2 group-hover:text-gray-300 transition-colors duration-300">
                {{ proposal.descricao }}
              </p>
              <!-- Gradient Fade -->
              <div class="absolute bottom-0 right-0 w-8 h-full bg-gradient-to-l from-gray-800/60 to-transparent"></div>
            </div>
          </div>

          <!-- Botão de Pagamento Melhorado -->
          <div *ngIf="shouldShowPayButton(proposal)" class="relative mb-6" (click)="$event.stopPropagation()">
            <button (click)="processInvestmentPayment(proposal)"
              class="w-full relative overflow-hidden bg-gradient-to-r from-orange-500 via-red-500 to-pink-600 hover:from-orange-400 hover:via-red-400 hover:to-pink-500 text-white font-bold py-4 px-6 rounded-2xl transition-all duration-300 shadow-xl hover:shadow-2xl hover:shadow-orange-500/25 transform hover:scale-105 group/button">

              <!-- Shimmer Effect -->
              <div
                class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -skew-x-12 -translate-x-full group-hover/button:translate-x-full transition-transform duration-700">
              </div>

              <div class="relative flex items-center justify-center space-x-3">
                <div class="relative">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                  </svg>
                  <!-- Icon Glow -->
                  <div class="absolute inset-0 bg-white/30 blur-md"></div>
                </div>
                <span class="text-lg">Efetuar Pagamento</span>
              </div>
            </button>
          </div>

          <!-- Estatísticas Financeiras Corrigidas -->
          <div class="relative">
            <!-- Separador Decorativo -->
            <div class="flex items-center mb-6">
              <div class="flex-1 h-px bg-gradient-to-r from-transparent via-gray-600/50 to-transparent"></div>
              <div class="px-4">
                <div class="w-2 h-2 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full"></div>
              </div>
              <div class="flex-1 h-px bg-gradient-to-r from-transparent via-gray-600/50 to-transparent"></div>
            </div>

            <div class="grid grid-cols-3 gap-6">
              <!-- Investimento -->
              <div class="text-center group/stat cursor-default">
                <div class="relative mb-3">
                  <div
                    class="w-12 h-12 mx-auto bg-gradient-to-br from-emerald-500/20 to-green-600/20 border border-emerald-500/30 rounded-2xl flex items-center justify-center backdrop-blur-sm group-hover/stat:scale-110 transition-transform duration-300">
                    <svg class="w-6 h-6 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                    </svg>
                  </div>
                </div>
                <p class="text-xs text-gray-500 mb-2 uppercase tracking-wider font-medium">Investimento</p>
                <p
                  class="text-white font-bold text-lg lg:text-xl bg-gradient-to-r from-emerald-400 to-green-400 bg-clip-text text-transparent">
                  {{ formatCurrency(proposal.investimento_minimo) }}
                </p>
              </div>

              <!-- Participação -->
              <div class="text-center group/stat cursor-default">
                <div class="relative mb-3">
                  <div
                    class="w-12 h-12 mx-auto bg-gradient-to-br from-blue-500/20 to-indigo-600/20 border border-blue-500/30 rounded-2xl flex items-center justify-center backdrop-blur-sm group-hover/stat:scale-110 transition-transform duration-300">
                    <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                  </div>
                </div>
                <p class="text-xs text-gray-500 mb-2 uppercase tracking-wider font-medium">Participação</p>
                <p class="text-blue-400 font-bold text-lg lg:text-xl">{{ proposal.porcentagem_cedida }}%</p>
              </div>

              <!-- Papel -->
              <div class="text-center group/stat cursor-default">
                <div class="relative mb-3">
                  <div
                    class="w-12 h-12 mx-auto bg-gradient-to-br from-purple-500/20 to-pink-600/20 border border-purple-500/30 rounded-2xl flex items-center justify-center backdrop-blur-sm group-hover/stat:scale-110 transition-transform duration-300">
                    <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                  </div>
                </div>
                <p class="text-xs text-gray-500 mb-2 uppercase tracking-wider font-medium">Papel</p>
                <p class="text-purple-400 font-bold text-sm lg:text-base">{{ getCurrentUserRole(proposal) }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredProposals.length === 0" class="text-center py-20">
      <div class="bg-gray-800/50 backdrop-blur-sm border border-gray-700/50 rounded-3xl p-12 max-w-md mx-auto">
        <div
          class="w-20 h-20 bg-gradient-to-r from-gray-600 to-gray-700 rounded-2xl flex items-center justify-center mx-auto mb-6">
          <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
        </div>
        <h3 class="text-xl font-bold text-white mb-3">Nenhum negócio encontrado</h3>
        <p class="text-gray-400 mb-6">Não há negócios fechados com os filtros selecionados.</p>
        <button (click)="statusFilter = 'all'; sortBy = 'date'; applyFilters()"
          class="inline-flex items-center gap-x-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium px-6 py-3 rounded-xl transition-all duration-200 shadow-lg hover:shadow-blue-500/25">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span>Limpar Filtros</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Melhorado -->
<div *ngIf="selectedProposal" id="modal-overlay" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden p-4"
  (click)="closeModal()">
  <div class="flex items-center justify-center min-h-screen">
    <div
      class="bg-gray-800/95 backdrop-blur-md border border-gray-700/50 rounded-3xl shadow-2xl max-w-5xl w-full max-h-[95vh] overflow-y-auto"
      (click)="$event.stopPropagation()">
      <!-- Modal Header Melhorado -->
      <div class="flex items-center justify-between p-8 border-b border-gray-700/50">
        <div class="flex items-center space-x-4">
          <div
            class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
              </path>
            </svg>
          </div>
          <div>
            <h2 class="text-2xl lg:text-3xl font-bold text-white">Detalhes do Negócio</h2>
            <p class="text-gray-400">Informações completas do investimento</p>
          </div>
        </div>

        <div class="flex items-center space-x-4">
          <!-- Status de Pagamento no Modal -->
          <div class="flex items-center space-x-2 px-4 py-2 rounded-xl" [ngClass]="{
                   'bg-green-500/20 border border-green-500/30': selectedProposal.paid,
                   'bg-orange-500/20 border border-orange-500/30': !selectedProposal.paid
                 }">
            <svg class="w-5 h-5" [ngClass]="getPaymentStatusColor(selectedProposal)" fill="currentColor"
              viewBox="0 0 20 20">
              <path *ngIf="selectedProposal.paid" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              <path *ngIf="!selectedProposal.paid"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z"
                clip-rule="evenodd"></path>
            </svg>
            <span class="text-sm font-semibold" [ngClass]="getPaymentStatusColor(selectedProposal)">
              {{ getPaymentStatus(selectedProposal) }}
            </span>
          </div>

          <!-- Botão Gerar PDF -->
          <button (click)="openPdfGenerator()"
            class="inline-flex items-center gap-x-2 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white font-medium px-4 py-2 rounded-xl transition-all duration-200 shadow-lg hover:shadow-purple-500/25">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
              </path>
            </svg>
            <span>PDF</span>
          </button>

          <button (click)="closeModal()"
            class="text-gray-400 hover:text-white transition-colors p-2 hover:bg-gray-700/50 rounded-xl">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      </div>

      <!-- Modal Content -->
      <div class="p-8">
        <!-- Botão de Pagamento Destacado no Modal -->
        <div *ngIf="shouldShowPayButton(selectedProposal)" class="mb-8">
          <div
            class="bg-gradient-to-r from-orange-500/20 to-red-600/20 border border-orange-500/30 rounded-2xl p-6 backdrop-blur-sm">
            <div class="flex flex-col lg:flex-row items-start lg:items-center justify-between gap-4">
              <div>
                <h3 class="text-xl font-bold text-white mb-2 flex items-center">
                  <svg class="w-6 h-6 text-orange-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  Pagamento Pendente
                </h3>
                <p class="text-gray-300">Complete o pagamento para finalizar este investimento e liberar todos os
                  recursos.</p>
              </div>
              <button (click)="processInvestmentPayment(selectedProposal!); $event.stopPropagation()"
                class="bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white font-bold py-4 px-8 rounded-xl transition-all duration-200 shadow-lg hover:shadow-orange-500/25 flex items-center space-x-3 whitespace-nowrap">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z">
                  </path>
                </svg>
                <span>Pagar {{ formatCurrency(selectedProposal.investimento_minimo) }}</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Badge de Status -->
        <div class="flex flex-col lg:flex-row lg:items-center justify-between mb-8 gap-4">
          <div class="flex items-center space-x-3">
            <div class="w-3 h-3 rounded-full" [ngClass]="{
             'bg-green-500': selectedProposal.status === 'accepted_request' || selectedProposal.status === 'accepted_proposal' || selectedProposal.status === 'accepted_contract' || selectedProposal.status === 'completed',
             'bg-yellow-500': selectedProposal.status === 'pending',
             'bg-red-500': selectedProposal.status === 'rejected' || selectedProposal.status === 'cancelled'
           }">
            </div>
            <span class="font-medium px-3 py-1 rounded-lg border" [ngClass]="{
              'text-green-400 bg-green-500/20 border-green-500/30': selectedProposal.status === 'accepted_request' || selectedProposal.status === 'accepted_proposal' || selectedProposal.status === 'accepted_contract' || selectedProposal.status === 'completed',
              'text-yellow-400 bg-yellow-500/20 border-yellow-500/30': selectedProposal.status === 'pending',
              'text-red-400 bg-red-500/20 border-red-500/30': selectedProposal.status === 'rejected' || selectedProposal.status === 'cancelled'
            }">
              {{ getStatusText(selectedProposal.status) }}
            </span>
          </div>
          <div class="bg-gray-700/50 px-3 py-1 rounded-lg">
            <span class="text-gray-400 text-sm">ID: #{{ selectedProposal.id }}</span>
          </div>
        </div>

        <!-- Informações da Ideia -->
        <div class="mb-10">
          <div class="flex flex-col lg:flex-row lg:items-start justify-between mb-6 gap-4">
            <h3 class="text-3xl lg:text-4xl font-bold text-white leading-tight">{{ selectedProposal.innovation_name
              }}
            </h3>
            <div
              class="flex items-center space-x-2 bg-blue-500/20 border border-blue-500/30 rounded-xl px-4 py-2 backdrop-blur-sm">
              <svg class="w-5 h-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span class="text-blue-400 font-semibold">Verificado</span>
            </div>
          </div>

          <div class="bg-gray-900/50 rounded-2xl p-8 border border-gray-700/30 backdrop-blur-sm">
            <p class="text-gray-300 leading-relaxed text-lg">
              {{ selectedProposal.descricao }}
            </p>
          </div>
        </div>

        <!-- Seção de Participantes com Fotos -->
        <div class="mb-8">
          <h4 class="text-lg font-semibold text-white mb-4 flex items-center">
            <svg class="w-5 h-5 text-blue-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z">
              </path>
            </svg>
            Participantes
          </h4>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Criador da Ideia -->
            <div
              class="bg-gray-900/50 rounded-xl p-5 border border-gray-700/30 hover:bg-gray-800/50 hover:border-gray-600/50 transition-all duration-300">
              <div class="flex items-center space-x-4">
                <div class="relative">
                  <img [src]="getProfileImageUrl(selectedProposal!.sponsored_img_url, selectedProposal!.sponsored_name)"
                    [alt]="selectedProposal!.sponsored_name"
                    class="w-14 h-14 rounded-full object-cover border-2 border-blue-500/30 ring-2 ring-blue-500/20">
                  <div
                    class="absolute -bottom-1 -right-1 w-5 h-5 bg-blue-500 rounded-full border-2 border-gray-900 flex items-center justify-center">
                    <svg class="w-2.5 h-2.5 text-white" fill="currentColor" viewBox="0 0 20 20">
                      <path
                        d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z">
                      </path>
                    </svg>
                  </div>
                </div>
                <div class="flex-1">
                  <h5 class="text-white font-semibold text-lg">{{ selectedProposal!.sponsored_name }}</h5>
                  <p class="text-blue-400 text-sm font-medium mb-2">Criador da Ideia</p>
                  <div class="flex items-center space-x-2">
                    <span
                      class="text-xs text-emerald-400 bg-emerald-500/20 px-2 py-1 rounded-full border border-emerald-500/30 font-medium">
                      {{ 100 - selectedProposal!.porcentagem_cedida }}% Participação
                    </span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Investidor -->
            <div
              class="bg-gray-900/50 rounded-xl p-5 border border-gray-700/30 hover:bg-gray-800/50 hover:border-gray-600/50 transition-all duration-300">
              <div class="flex items-center space-x-4">
                <div class="relative">
                  <img [src]="getProfileImageUrl(selectedProposal!.investor_img_url, selectedProposal!.investor_name)"
                    [alt]="selectedProposal!.investor_name"
                    class="w-14 h-14 rounded-full object-cover border-2 border-emerald-500/30 ring-2 ring-emerald-500/20">
                  <div
                    class="absolute -bottom-1 -right-1 w-5 h-5 bg-emerald-500 rounded-full border-2 border-gray-900 flex items-center justify-center">
                    <svg class="w-2.5 h-2.5 text-white" fill="currentColor" viewBox="0 0 20 20">
                      <path
                        d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z">
                      </path>
                      <path fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z"
                        clip-rule="evenodd"></path>
                    </svg>
                  </div>
                </div>
                <div class="flex-1">
                  <h5 class="text-white font-semibold text-lg">{{ selectedProposal!.investor_name }}</h5>
                  <p class="text-emerald-400 text-sm font-medium mb-2">Investidor</p>
                  <div class="flex items-center space-x-2">
                    <span
                      class="text-xs text-blue-400 bg-blue-500/20 px-2 py-1 rounded-full border border-blue-500/30 font-medium">
                      {{ selectedProposal!.porcentagem_cedida }}% Participação
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Informações Financeiras -->
        <div class="border-t border-gray-700/50 pt-8">
          <h4 class="text-lg font-semibold text-white mb-6 flex items-center">
            <svg class="w-5 h-5 text-emerald-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
            </svg>
            Detalhes Financeiros
          </h4>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Valor Total -->
            <div
              class="bg-gradient-to-br from-emerald-500/20 to-green-600/20 border border-emerald-500/30 rounded-xl p-6 relative overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
              <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/10 to-transparent"></div>
              <div class="relative">
                <div class="flex items-center justify-between mb-3">
                  <div
                    class="w-12 h-12 bg-emerald-500/20 border border-emerald-500/30 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                    </svg>
                  </div>
                </div>
                <p class="text-emerald-300 font-medium mb-1">Valor Total</p>
                <p class="text-3xl font-bold text-white">{{ formatCurrency(selectedProposal.investimento_minimo) }}
                </p>
                <p class="text-emerald-400 text-sm mt-1">Desde {{ formatDate(selectedProposal.created) }}</p>
              </div>
            </div>

            <!-- Porcentagem Cedida Corrigida -->
            <div
              class="bg-gradient-to-br from-blue-500/20 to-indigo-600/20 border border-blue-500/30 rounded-xl p-6 relative overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300">
              <div class="absolute inset-0 bg-gradient-to-br from-blue-500/10 to-transparent"></div>
              <div class="relative">
                <div class="flex items-center justify-between mb-3">
                  <div
                    class="w-12 h-12 bg-blue-500/20 border border-blue-500/30 rounded-lg flex items-center justify-center">
                    <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                  </div>
                </div>
                <p class="text-blue-300 font-medium mb-1">Participação</p>
                <p class="text-3xl font-bold text-white">{{ selectedProposal.porcentagem_cedida }}%</p>
                <p class="text-blue-400 text-sm mt-1">Cedida ao Investidor</p>
              </div>
            </div>

            <!-- Status Pagamento -->
            <div
              class="rounded-xl p-6 relative overflow-hidden hover:shadow-xl hover:-translate-y-1 transition-all duration-300"
              [ngClass]="{
        'bg-gradient-to-br from-green-500/20 to-emerald-600/20 border border-green-500/30': selectedProposal.paid,
        'bg-gradient-to-br from-orange-500/20 to-red-600/20 border border-orange-500/30': !selectedProposal.paid
      }">
              <div class="absolute inset-0 bg-gradient-to-br from-green-500/10 to-transparent"
                *ngIf="selectedProposal.paid"></div>
              <div class="absolute inset-0 bg-gradient-to-br from-orange-500/10 to-transparent"
                *ngIf="!selectedProposal.paid"></div>
              <div class="relative">
                <div class="flex items-center justify-between mb-3">
                  <div class="w-12 h-12 rounded-lg flex items-center justify-center" [ngClass]="{
            'bg-green-500/20 border border-green-500/30': selectedProposal.paid,
            'bg-orange-500/20 border border-orange-500/30': !selectedProposal.paid
          }">
                    <svg class="w-6 h-6" [ngClass]="getPaymentStatusColor(selectedProposal)" fill="currentColor"
                      viewBox="0 0 20 20">
                      <path *ngIf="selectedProposal.paid" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      <path *ngIf="!selectedProposal.paid"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z">
                      </path>
                    </svg>
                  </div>
                </div>
                <p class="font-medium mb-1" [ngClass]="getPaymentStatusColor(selectedProposal)">Status</p>
                <p class="text-2xl font-bold text-white">{{ getPaymentStatus(selectedProposal) }}</p>
                <p class="text-sm mt-1" [ngClass]="getPaymentStatusColor(selectedProposal)">
                  {{ selectedProposal.paid ? 'Pagamento Concluído' : 'Aguardando Pagamento' }}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Assinaturas -->
    <div *ngIf="showSignatureModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 p-4"
      (click)="closeSignatureModal()">
      <div class="flex items-center justify-center min-h-screen">
        <div
          class="bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden"
          (click)="$event.stopPropagation()">

          <!-- Header -->
          <div class="p-6 border-b border-gray-700">
            <div class="flex items-center justify-between">
              <h3 class="text-xl font-bold text-white">Status das Assinaturas</h3>
              <button (click)="closeSignatureModal()" class="text-gray-400 hover:text-white">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                  </path>
                </svg>
              </button>
            </div>
          </div>

          <!-- Content -->
          <div class="p-6 max-h-[70vh] overflow-y-auto">

            <!-- Loading -->
            <div *ngIf="signatureLoading" class="text-center py-8">
              <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
              <p class="text-white mt-4">Carregando assinaturas...</p>
            </div>

            <!-- Error -->
            <div *ngIf="signatureError && !signatureLoading"
              class="bg-red-500/10 border border-red-500/30 rounded-xl p-4">
              <p class="text-red-400">{{ signatureError }}</p>
            </div>

            <!-- Data -->
            <div *ngIf="signatureData && !signatureLoading && !signatureError">

              <!-- Resumo -->
              <div class="mb-6 bg-gray-900/50 rounded-xl p-4">
                <h4 class="text-white font-semibold mb-3">{{ signatureData.innovation_info.name }}</h4>
                <div class="grid grid-cols-2 gap-4 text-sm">
                  <div>
                    <span class="text-gray-400">Total de Assinaturas:</span>
                    <span class="text-white ml-2">{{ signatureData.signatures_summary.total_signatures }}/2</span>
                  </div>
                  <div>
                    <span class="text-gray-400">Status:</span>
                    <span class="ml-2"
                      [class]="signatureData.signatures_summary.contract_fully_signed ? 'text-green-400' : 'text-orange-400'">
                      {{ signatureData.signatures_summary.contract_fully_signed ? 'Completo' : 'Pendente' }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Investidor -->
              <div class="mb-4 bg-gray-900/50 rounded-xl p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <h5 class="text-white font-medium">{{ signatureData.investor_info.name }}</h5>
                    <p class="text-gray-400 text-sm">Investidor</p>
                  </div>
                  <div class="flex items-center space-x-2">
                    <span [class]="signatureData.investor_info.has_signed ? 'text-green-400' : 'text-orange-400'"
                      class="text-sm font-medium">
                      {{ signatureData.investor_info.has_signed ? 'Assinado' : 'Pendente' }}
                    </span>
                    <button *ngIf="signatureData.investor_info.pdf_url"
                      (click)="downloadSignedPdf(signatureData.investor_info.pdf_url, signatureData.investor_info.pdf_filename)"
                      class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                      PDF
                    </button>
                  </div>
                </div>
                <div *ngIf="signatureData.investor_info.signed_at" class="mt-2">
                  <p class="text-gray-400 text-xs">Assinado em: {{
                    formatDateTime(signatureData.investor_info.signed_at)
                    }}</p>
                </div>
              </div>

              <!-- Idealizador -->
              <div class="mb-4 bg-gray-900/50 rounded-xl p-4">
                <div class="flex items-center justify-between">
                  <div>
                    <h5 class="text-white font-medium">{{ signatureData.sponsored_info.name }}</h5>
                    <p class="text-gray-400 text-sm">Idealizador</p>
                  </div>
                  <div class="flex items-center space-x-2">
                    <span [class]="signatureData.sponsored_info.has_signed ? 'text-green-400' : 'text-orange-400'"
                      class="text-sm font-medium">
                      {{ signatureData.sponsored_info.has_signed ? 'Assinado' : 'Pendente' }}
                    </span>
                    <button *ngIf="signatureData.sponsored_info.pdf_url"
                      (click)="downloadSignedPdf(signatureData.sponsored_info.pdf_url, signatureData.sponsored_info.pdf_filename)"
                      class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-1 rounded text-sm">
                      PDF
                    </button>
                  </div>
                </div>
                <div *ngIf="signatureData.sponsored_info.signed_at" class="mt-2">
                  <p class="text-gray-400 text-xs">Assinado em: {{
                    formatDateTime(signatureData.sponsored_info.signed_at) }}</p>
                </div>
              </div>

              <!-- Seu Status -->
              <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
                <h5 class="text-blue-400 font-medium mb-2">Seu Status</h5>
                <p class="text-gray-300 text-sm mb-2">
                  Você é: {{ signatureData.current_user.role === 'investor' ? 'Investidor' : 'Idealizador' }}
                </p>
                <p class="text-gray-300 text-sm">
                  Status:
                  <span [class]="signatureData.current_user.has_signed ? 'text-green-400' : 'text-orange-400'"
                    class="font-medium ml-1">
                    {{ signatureData.current_user.has_signed ? 'Você já assinou' : 'Você ainda não assinou' }}
                  </span>
                </p>

                <button *ngIf="signatureData.current_user.pdf_info?.pdf_url"
                  (click)="downloadSignedPdf(signatureData.current_user.pdf_info.pdf_url, signatureData.current_user.pdf_info.pdf_filename)"
                  class="mt-3 bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded text-sm">
                  Baixar Meu PDF
                </button>

                <button *ngIf="!signatureData.current_user.has_signed && signatureData.current_user.can_sign"
                  (click)="closeSignatureModal(); openPdfGenerator()"
                  class="mt-3 bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-sm">
                  Assinar Agora
                </button>
              </div>

            </div>
          </div>

          <!-- Footer -->
          <div class="p-6 border-t border-gray-700">
            <button (click)="closeSignatureModal()"
              class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-xl">
              Fechar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- PDF Generator Modal -->
    <div *ngIf="showPdfGenerator" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 p-2"
      (click)="closePdfGenerator()">
      <div class="flex items-center justify-center min-h-screen">
        <div
          class="bg-gray-800/95 backdrop-blur-md border border-gray-700/50 rounded-3xl shadow-2xl w-full max-w-[95vw] h-[95vh] flex overflow-hidden"
          (click)="$event.stopPropagation()">

          <!-- Formulário Lateral Esquerdo -->
          <div class="w-1/4 border-r border-gray-700/50 p-6 overflow-y-auto">
            <div class="mb-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold text-white flex items-center">

                  Configurar PDF
                </h3>
                <button (click)="closePdfGenerator()"
                  class="text-gray-400 hover:text-white transition-colors p-2 hover:bg-gray-700/50 rounded-xl">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                  </svg>
                </button>
              </div>
              <p class="text-gray-400 text-sm">Personalize seu relatório ajustando as configurações abaixo</p>
            </div>

            <form class="space-y-6">
              <!-- Título -->
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-2">Título do Documento</label>
                <input type="text" [(ngModel)]="pdfFormData.title" name="title" readonly
                  class="w-full bg-gray-800/30 border border-gray-700/30 text-gray-300 rounded-xl px-4 py-3 text-sm cursor-not-allowed"
                  placeholder="Digite o título">
              </div>

              <!-- Subtítulo -->
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-2">Subtítulo</label>
                <input type="text" [(ngModel)]="pdfFormData.subtitle" name="subtitle" readonly
                  class="w-full bg-gray-800/30 border border-gray-700/30 text-gray-300 rounded-xl px-4 py-3 text-sm cursor-not-allowed"
                  placeholder="Digite o subtítulo">
              </div>

              <!-- Descrição -->
              <div>
                <label class="block text-sm font-medium text-gray-400 mb-2">Descrição Personalizada</label>
                <textarea [(ngModel)]="pdfFormData.description" name="description" rows="4" readonly
                  class="w-full bg-gray-800/30 border border-gray-700/30 text-gray-300 rounded-xl px-4 py-3 text-sm cursor-not-allowed resize-none"
                  placeholder="Digite uma descrição personalizada"></textarea>
              </div>

              <!-- Opções de Inclusão -->
              <div class="space-y-4">
                <h4 class="text-lg font-semibold text-gray-400">Seções a Incluir</h4>

                <div class="space-y-3">
                  <label class="flex items-center space-x-3 cursor-not-allowed">
                    <input type="checkbox" [(ngModel)]="pdfFormData.includeFinancialData" name="includeFinancialData"
                      disabled class="w-5 h-5 text-gray-600 bg-gray-800 border-gray-700 rounded cursor-not-allowed">
                    <span class="text-gray-400">Informações Financeiras</span>
                  </label>

                  <label class="flex items-center space-x-3 cursor-not-allowed">
                    <input type="checkbox" [(ngModel)]="pdfFormData.includeParticipants" name="includeParticipants"
                      disabled class="w-5 h-5 text-gray-600 bg-gray-800 border-gray-700 rounded cursor-not-allowed">
                    <span class="text-gray-400">Dados dos Participantes</span>
                  </label>

                  <label class="flex items-center space-x-3 cursor-not-allowed">
                    <input type="checkbox" [(ngModel)]="pdfFormData.includeTimeline" name="includeTimeline" disabled
                      class="w-5 h-5 text-gray-600 bg-gray-800 border-gray-700 rounded cursor-not-allowed">
                    <span class="text-gray-400">Timeline do Negócio</span>
                  </label>
                </div>
              </div>

              <!-- Assinatura Digital -->
              <div class="space-y-4 border-t border-gray-700/50 pt-6">
                <div class="flex items-center space-x-2">
                  <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9 12l2 2 4-4m5-6a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <h4 class="text-lg font-semibold text-white">Assinatura Digital</h4>
                </div>
                <p class="text-gray-400 text-sm">Preencha seus dados para assinar digitalmente o contrato</p>

                <!-- Payment Required Message for Unpaid Investors -->
                <div *ngIf="requiresPaymentBeforeSignature()"
                  class="bg-orange-500/10 border border-orange-500/30 rounded-xl p-4 mb-4">
                  <div class="flex items-start space-x-3">
                    <svg class="w-6 h-6 text-orange-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor"
                      viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.002 16.5c-.77.833.192 2.5 1.732 2.5z">
                      </path>
                    </svg>
                    <div>
                      <h5 class="font-semibold text-orange-300 mb-2">Pagamento Necessário</h5>
                      <p class="text-sm text-orange-200 mb-3">
                        Como investidor, você deve completar o pagamento antes de poder assinar o contrato.
                      </p>
                      <button type="button"
                        (click)="processInvestmentPayment(selectedProposal!); $event.stopPropagation()"
                        class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white font-medium rounded-lg transition-all duration-200 text-sm">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z">
                          </path>
                        </svg>
                        Efetuar Pagamento
                      </button>
                    </div>
                  </div>
                </div>

                <!-- Signature Fields (disabled when payment required) -->
                <div [class.opacity-50]="requiresPaymentBeforeSignature()"
                  [class.pointer-events-none]="requiresPaymentBeforeSignature()">

                  <!-- Tipo de Documento -->
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Tipo de Documento</label>
                    <select [(ngModel)]="pdfFormData.documentType" (ngModelChange)="updatePdfPreview()"
                      name="documentType"
                      class="w-full bg-gray-900/50 border border-gray-600/50 text-white rounded-xl px-4 py-3 text-sm focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200">
                      <option value="cpf">CPF (Pessoa Física)</option>
                      <option value="cnpj">CNPJ (Pessoa Jurídica)</option>
                    </select>
                  </div>

                  <!-- Campo CPF/CNPJ -->
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2 flex items-center space-x-2">
                      <span>{{ pdfFormData.documentType === 'cpf' ? 'CPF' : 'CNPJ' }}</span>
                      <svg *ngIf="pdfFormData.documentNumber.trim() && validateDocument()"
                        class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      </svg>
                      <svg *ngIf="pdfFormData.documentNumber.trim() && !validateDocument()" class="w-4 h-4 text-red-400"
                        fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                      </svg>
                    </label>
                    <div class="relative">
                      <input type="text" [(ngModel)]="pdfFormData.documentNumber"
                        (input)="formatDocumentNumber(); updatePdfPreview()" name="documentNumber"
                        [placeholder]="pdfFormData.documentType === 'cpf' ? '000.000.000-00' : '00.000.000/0000-00'"
                        [class]="'w-full bg-gray-900/50 border text-white rounded-xl px-4 py-3 text-sm focus:ring-2 focus:border-transparent transition-all duration-200 ' + 
                                    (pdfFormData.documentNumber.trim() && validateDocument() ? 'border-green-500/50 focus:ring-green-500' :
                                     pdfFormData.documentNumber.trim() && !validateDocument() ? 'border-red-500/50 focus:ring-red-500' : 
                                     'border-gray-600/50 focus:ring-green-500')"
                        maxlength="{{ pdfFormData.documentType === 'cpf' ? 14 : 18 }}" autocomplete="off">
                      <div *ngIf="pdfFormData.documentNumber.trim() && validateDocument()"
                        class="absolute right-3 top-1/2 transform -translate-y-1/2">
                        <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7">
                          </path>
                        </svg>
                      </div>
                    </div>
                    <p class="text-gray-500 text-xs mt-1"
                      *ngIf="!pdfFormData.documentNumber.trim() || validateDocument()">
                      {{ pdfFormData.documentType === 'cpf' ? 'Digite apenas números, a formatação será automática'
                      :
                      'Digite apenas números, a formatação será automática' }}
                    </p>
                    <p class="text-red-400 text-xs mt-1"
                      *ngIf="pdfFormData.documentNumber.trim() && !validateDocument()">
                      {{ pdfFormData.documentType === 'cpf' ? 'CPF inválido' : 'CNPJ inválido' }}
                    </p>
                  </div>

                  <!-- Nome Completo -->
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2 flex items-center space-x-2">
                      <span>Nome Completo</span>
                      <svg *ngIf="pdfFormData.signerName.trim().length >= 3" class="w-4 h-4 text-green-400" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      </svg>
                    </label>
                    <input type="text" [(ngModel)]="pdfFormData.signerName" (ngModelChange)="updatePdfPreview()"
                      name="signerName"
                      [class]="'w-full bg-gray-900/50 border text-white rounded-xl px-4 py-3 text-sm focus:ring-2 focus:border-transparent transition-all duration-200 ' + 
                                  (pdfFormData.signerName.trim().length >= 3 ? 'border-green-500/50 focus:ring-green-500' : 'border-gray-600/50 focus:ring-green-500')"
                      placeholder="Digite seu nome completo">
                  </div>

                  <!-- Email -->
                  <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2 flex items-center space-x-2">
                      <span>Email</span>
                      <svg *ngIf="pdfFormData.signerEmail.includes('@') && pdfFormData.signerEmail.includes('.')"
                        class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                      </svg>
                    </label>
                    <input type="email" [(ngModel)]="pdfFormData.signerEmail" (ngModelChange)="updatePdfPreview()"
                      name="signerEmail"
                      [class]="'w-full bg-gray-900/50 border text-white rounded-xl px-4 py-3 text-sm focus:ring-2 focus:border-transparent transition-all duration-200 ' + 
                                  (pdfFormData.signerEmail.includes('@') && pdfFormData.signerEmail.includes('.') ? 'border-green-500/50 focus:ring-green-500' : 'border-gray-600/50 focus:ring-green-500')"
                      placeholder="seu@email.com">
                  </div>

                  <!-- Confirmação de Assinatura -->
                  <div class="bg-green-500/10 border border-green-500/30 rounded-xl p-4">
                    <label class="flex items-start space-x-3 cursor-pointer">
                      <input type="checkbox" [(ngModel)]="pdfFormData.acceptSignature" name="acceptSignature"
                        class="w-5 h-5 text-green-600 bg-gray-900 border-gray-600 rounded focus:ring-green-500 focus:ring-2 mt-0.5">
                      <div class="text-sm text-gray-300">
                        <p class="font-medium text-green-400">Confirmo que:</p>
                        <ul class="mt-2 space-y-1 text-xs text-gray-400">
                          <li>Concordo com os termos do contrato</li>
                          <li>As informações fornecidas são verdadeiras</li>
                          <li>Tenho capacidade legal para assinar este documento</li>
                          <li>Autorizo a captura de dados para validação da assinatura</li>
                        </ul>
                      </div>
                    </label>
                  </div>

                  <!-- Informações de Segurança -->
                  <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
                    <div class="flex items-start space-x-2">
                      <svg class="w-5 h-5 text-blue-400 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
                        </path>
                      </svg>
                      <div class="text-sm">
                        <p class="font-medium text-blue-400">Segurança da Assinatura</p>
                        <p class="text-xs text-gray-400 mt-1">
                          Capturaremos informações como horário, endereço IP, navegador e dispositivo para garantir
                          a
                          autenticidade da assinatura digital.
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- End signature fields -->

              <!-- Botões de Ação -->
              <div class="flex flex-col space-y-3 pt-6 border-t border-gray-700/50">
                <button type="button" data-sign-button (click)="downloadPdf()" [disabled]="!canSignDocument()"
                  [class]="canSignDocument() ? 
                          'w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-semibold py-3 px-4 rounded-xl transition-all duration-200 shadow-lg hover:shadow-green-500/25 flex items-center justify-center space-x-2' :
                          'w-full bg-gray-600 text-gray-400 font-semibold py-3 px-4 rounded-xl cursor-not-allowed flex items-center justify-center space-x-2'">>
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <span>{{ canSignDocument() ? 'Assinar e Baixar PDF' : 'Preencha os Dados para Assinar' }}</span>
                </button>

                <button type="button" (click)="updatePdfPreview()"
                  class="w-full bg-gray-700 hover:bg-gray-600 text-white font-medium py-3 px-4 rounded-xl transition-all duration-200 flex items-center justify-center space-x-2">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                    </path>
                  </svg>
                  <span>Atualizar Preview</span>
                </button>
              </div>
            </form>
          </div>

          <!-- Preview do PDF à Direita -->
          <div class="flex-1 flex flex-col">
            <div class="p-6 border-b border-gray-700/50">
              <h3 class="text-xl font-bold text-white flex items-center">
                <svg class="w-6 h-6 text-blue-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                  </path>
                </svg>
                Preview do Documento
              </h3>
              <p class="text-gray-400 text-sm mt-1">Visualização em tempo real do seu PDF</p>
            </div>

            <div class="flex-1 p-6">
              <div class="h-full bg-white rounded-xl shadow-2xl overflow-hidden">

                <iframe *ngIf="pdfUrl" [src]="pdfUrl" class="w-full h-full border-0" title="Preview do PDF">
                </iframe>

                <div *ngIf="!pdfUrl" class="h-full flex items-center justify-center bg-gray-100">
                  <div class="text-center">
                    <div class="w-16 h-16 bg-gray-300 rounded-xl flex items-center justify-center mx-auto mb-4">
                      <svg class="w-8 h-8 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                        </path>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal de Pagamento Melhorado -->
      <div *ngIf="showPaymentModal" class="fixed inset-0 bg-black/70 backdrop-blur-sm z-50 p-4"
        (click)="closePaymentModal()">
        <div class="flex items-center justify-center min-h-screen">
          <div
            class="bg-gray-800/95 backdrop-blur-md border border-gray-700/50 rounded-2xl shadow-2xl max-w-lg w-full transform transition-all duration-300"
            [class.scale-105]="paymentSuccess" (click)="$event.stopPropagation()">

            <!-- Header Melhorado -->
            <div class="p-6 border-b border-gray-700/50">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <div class="w-10 h-10 rounded-xl flex items-center justify-center transition-all duration-300"
                    [class]="paymentSuccess ? 'bg-green-500/20 border border-green-500/30' : 'bg-gradient-to-r from-orange-500 to-red-600'">
                    <svg *ngIf="!paymentSuccess" class="w-5 h-5 text-white" fill="none" stroke="currentColor"
                      viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z">
                      </path>
                    </svg>
                    <svg *ngIf="paymentSuccess" class="w-6 h-6 text-green-400" fill="none" stroke="currentColor"
                      viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                  </div>
                  <div>
                    <h3 class="text-xl font-bold text-white transition-colors duration-300">
                      {{ paymentSuccess ? 'Pagamento Realizado!' : 'Confirmar Pagamento' }}
                    </h3>
                    <p class="text-gray-400 text-sm">
                      {{ paymentSuccess ? 'Investimento processado com sucesso' : 'Finalize seu investimento' }}
                    </p>
                  </div>
                </div>
                <button *ngIf="!paymentLoading && !paymentSuccess" (click)="closePaymentModal()"
                  class="text-gray-400 hover:text-white transition-colors p-2 hover:bg-gray-700/50 rounded-xl">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Corpo Melhorado -->
            <div class="p-6">
              <!-- Informações do Investimento -->
              <div *ngIf="selectedPaymentProposal && !paymentSuccess" class="mb-6">
                <div class="bg-gray-900/50 rounded-xl p-5 border border-gray-700/30">
                  <h4 class="text-white font-semibold mb-4 flex items-center">
                    <svg class="w-5 h-5 text-blue-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    {{ selectedPaymentProposal.innovation_name }}
                  </h4>
                  <div class="space-y-3">
                    <div class="flex justify-between items-center p-3 bg-gray-800/50 rounded-lg">
                      <span class="text-gray-400 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1" />
                        </svg>
                        Valor do Investimento:
                      </span>
                      <span class="text-white font-bold text-lg">{{
                        formatCurrency(selectedPaymentProposal.investimento_minimo) }}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-gray-800/50 rounded-lg">
                      <span class="text-gray-400 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                        Sua Participação:
                      </span>
                      <span class="text-blue-400 font-bold text-lg">{{ selectedPaymentProposal.porcentagem_cedida
                        }}%</span>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Animação de Sucesso -->
              <div *ngIf="paymentSuccess" class="mb-6 text-center">
                <div
                  class="w-20 h-20 bg-green-500/20 border border-green-500/30 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse">
                  <svg class="w-10 h-10 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                </div>
                <h4 class="text-xl font-bold text-green-400 mb-2">Pagamento Processado!</h4>
                <p class="text-gray-300 mb-4">Seu investimento foi confirmado com sucesso</p>
                <div class="bg-green-500/10 border border-green-500/30 rounded-xl p-4">
                  <div class="flex items-center justify-center space-x-2">

                    <span class="text-green-300 text-sm font-medium">Atualizando informações...</span>
                  </div>
                  <div class="w-full bg-green-900/30 rounded-full h-2 mt-3">
                    <div class="bg-green-500 h-2 rounded-full animate-pulse" style="width: 100%"></div>
                  </div>
                </div>
              </div>

              <!-- Mensagem de Erro Melhorada -->
              <div *ngIf="paymentError"
                class="mb-4 p-4 bg-red-500/10 border border-red-500/30 rounded-xl animate-shake">
                <div class="flex items-start space-x-3">
                  <svg class="w-6 h-6 text-red-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <div>
                    <h5 class="text-red-300 font-semibold mb-1">Erro no Pagamento</h5>
                    <p class="text-red-200 text-sm">{{ paymentError }}</p>
                  </div>
                </div>
              </div>

              <!-- Texto de Confirmação -->
              <div *ngIf="!paymentSuccess && !paymentError" class="text-center mb-6">
                <div class="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
                  <div class="flex items-center justify-center space-x-2 mb-2">
                    <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z">
                      </path>
                    </svg>
                    <span class="text-blue-400 font-semibold text-sm">Transação Segura</span>
                  </div>
                  <p class="text-gray-300 text-sm">
                    Ao confirmar, você está concordando em investir no projeto selecionado.
                    Esta transação é processada de forma segura.
                  </p>
                </div>
              </div>

              <!-- Loading State Melhorado -->
              <div *ngIf="paymentLoading && !paymentSuccess" class="mb-6 text-center">
                <div class="flex flex-col items-center space-y-4">
                  <div class="relative">
                    <div class="w-16 h-16 border-4 border-blue-200/20 rounded-full"></div>
                    <div
                      class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin absolute top-0 left-0">
                    </div>
                  </div>
                  <div>
                    <p class="text-white font-semibold">Processando Pagamento...</p>
                    <p class="text-gray-400 text-sm">Aguarde enquanto confirmamos sua transação</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Footer Melhorado -->
            <div class="p-6 border-t border-gray-700/50">
              <div *ngIf="!paymentSuccess" class="flex space-x-3">
                <button *ngIf="!paymentLoading" (click)="closePaymentModal()"
                  class="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-medium py-3 px-4 rounded-xl transition-all duration-200 flex items-center justify-center space-x-2">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                  </svg>
                  <span>Cancelar</span>
                </button>

                <button (click)="processPayment()" [disabled]="paymentLoading"
                  class="flex-1 font-semibold py-3 px-4 rounded-xl transition-all duration-200 flex items-center justify-center space-x-2"
                  [class]="!paymentLoading ? 
                      'bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 text-white shadow-lg hover:shadow-emerald-500/25 transform hover:scale-105' :
                      'bg-gray-600 text-gray-400 cursor-not-allowed'">

                  <span *ngIf="!paymentLoading" class="flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>Confirmar Pagamento</span>
                  </span>

                  <span *ngIf="paymentLoading" class="flex items-center justify-center space-x-2">

                    <span>Processando...</span>
                  </span>
                </button>
              </div>

              <!-- Footer do estado de sucesso -->
              <div *ngIf="paymentSuccess" class="text-center">
                <p class="text-gray-400 text-sm mb-3">
                  A página será atualizada automaticamente em alguns segundos...
                </p>
                <button (click)="closePaymentModal(); reloadPage()"
                  class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-6 rounded-xl transition-all duration-200">
                  Atualizar Agora
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>